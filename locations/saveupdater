# saveupdater


if VersionCheck < 504:
	gs 'npcstatic'
	pcs_dob = birthyear * 10000
	pcs_dob += birthmonth * 100
	pcs_dob += birthday
	pcs_horny = horny
	pcs_stren = stren
	pcs_agil  = agil
	pcs_vital = vital
	pcs_intel = intel
	pcs_haircol = hcol
	npc_rel['A28'] = father
	npc_rel['A29'] = mother
	npc_rel['A33'] = sister
	npc_rel['A34'] = brother
	pcs_grades = Suspeh
	pcs_tan = tan
	pcs_vball = volleyboll
	pcs_hairlng = hairlength
	pcs_haircol = hcol
	npc_nerd[pc] = nerdism
	pcs_dom = dom
	$npc_firstname['A<<npctemp>>'] = $name
	$npc_nickname['A<<npctemp>>'] = $nickname
	$npc_lastname['A<<npctemp>>'] = $surname
	$npc_usedname['A<<npctemp>>'] = $nickname
	VersionCheck = 5030
	npc_QW['A33'] = sisboyQW
	npc_QW['A34'] = brotherQW
	npc_QW['A29'] = motherQW
	npc_QW['A89'] = barmenshameet
	npc_rel['A89'] = JenyaLC
	LCEugenefirst = JenyaLCfirst
	killvar 'sisboyQW'
	killvar 'brotherQW'
	killvar 'motherQW'
	killvar 'barmenshameet'
	killvar 'JenyaLC'
	killvar 'JenyaLCfirst'
	killvar 'horny'
	killvar 'stren'
	killvar 'agil'
	killvar 'vital'
	killvar 'intel'
	killvar 'hcol'
	killvar 'father'
	killvar 'mother'
	killvar 'sister'
	killvar 'brother'
	killvar 'Suspeh'
	killvar 'tan'
	killvar 'volleyboll'
	killvar 'hairlength'
	killvar 'hcol'
	killvar 'nerdism'
	killvar 'dom'
	killvar '$name'
	killvar '$nickname'
	killvar '$surname'
	killvar '$boy'
	$boy = 'D0'

	!!The following part update the cum related arrays from an old savegame to the new MGX format.
	cycletemp = 0
	:cumarrupd
	if cycletemp < arrsize('$cumarrnam'):
		tempnpcid = arrpos('$pcs_firstname', $cumarrnam[cycletemp])
		if tempnpcid > 0:
			MSG '<br><b><font color="teal">DEBUG: Legacy name in save updated from <<$cumarrnam[cycletemp]>> to A<<tempnpcid>></font></b>'
			$cumarrnam[cycletemp] = 'A<<tempnpcid>>'
		elseif cumarrkno[cycletemp] > 0:
			MSG '<br><b><font color="red">WARNING: Unable to upgrade correctly cum entry <<cycletemp>> with name <<$cumarrnam[cycletemp]>></font></b>'
			gs 'npcgeneratec', 0, $cumarrnam[cycletemp], rand(18,60)
			$cumarrnam[cycletemp] = $npclastgenerated
		else
			gs 'npcgeneratec', 0, $cumarrnam[cycletemp], rand(18,60)
			$cumarrnam[cycletemp] = $npclastgenerated
		end
		cycletemp += 1
		jump 'cumarrupd'
	end
	cycletemp = 0
	:sparrupd
	if cycletemp < arrsize('$sparrnam'):
		tempnpcid = arrpos('$pcs_firstname', $sparrnam[cycletemp])
		if tempnpcid > 0:
			MSG '<br><b><font color="teal">DEBUG: Legacy name in save updated from <<$sparrnam[cycletemp]>> to A<<tempnpcid>></font></b>'
			$sparrnam[cycletemp] = 'A<<tempnpcid>>'
		elseif sparrkno[cycletemp] > 0:
			MSG '<br><b><font color="red">WARNING: Unable to upgrade correctly spatter entry <<cycletemp>> with name <<$sparrnam[cycletemp]>></font></b>'
			gs 'npcgeneratec', 0, $sparrnam[cycletemp], rand(18,60)
			$sparrnam[cycletemp] = $npclastgenerated
		else
			gs 'npcgeneratec', 0, $sparrnam[cycletemp], rand(18,60)
			$sparrnam[cycletemp] = $npclastgenerated
		end
		cycletemp +=1
		jump 'sparrupd'
	end
	cycletemp = 0
	:cumcbcupd
	if cycletemp < arrsize('$ChildFath'):
		tempnpcid = arrpos('$pcs_firstname', $ChildFath[cycletemp])
		if tempnpcid > 0:
			MSG '<br><b><font color="teal">DEBUG: Legacy name in save updated from <<$ChildFath[cycletemp]>> to A<<tempnpcid>></font></b>'
			$ChildFath[cycletemp] = 'A<<tempnpcid>>'
		else
			MSG '<br><b><font color="red">WARNING: Unable to upgrade correctly father entry <<cycletemp>> with name <<$ChildFath[cycletemp]>></font></b>'
			gs 'npcgeneratec', 0, $ChildFath[cycletemp], rand(18,60)
			$ChildFath[cycletemp] = $npclastgenerated
		end
		tempnpcid = arrpos('$pcs_firstname', $ChildThFath[cycletemp])
		if tempnpcid > 0:
			MSG '<br><b><font color="teal">DEBUG: Legacy name in save updated from <<$ChildThFath[cycletemp]>> to A<<tempnpcid>></font></b>'
			$ChildThFath[cycletemp] = 'A<<tempnpcid>>'
		else
			MSG '<br><b><font color="red">WARNING: Unable to upgrade correctly tought father entry <<cycletemp>> with name <<$ChildThFath[cycletemp]>></font></b>'
			$ChildThFath[cycletemp] = 'unknown'
		end
		cycletemp +=1
		jump 'cumcbcupd'
	end
	cycletemp = 0
	:wombpotupd
	if cycletemp < arrsize('$wombpotfath'):
		tempnpcid = arrpos('$pcs_firstname', $wombpotfath[cycletemp])
		if tempnpcid > 0:
			MSG '<br><b><font color="teal">DEBUG: Legacy name in save updated from <<$wombpotfath[cycletemp]>> to A<<tempnpcid>></font></b>'
			$wombpotfath[cycletemp] = 'A<<tempnpcid>>'
		elseif $wombpotfath[cycletemp] = 'Unknown':
			$wombpotfath[cycletemp] = 'unknown'
		else
			MSG '<br><b><font color="red">WARNING: Unable to upgrade correctly father entry <<cycletemp>> with name <<$wombpotfath[cycletemp]>></font></b>'
			gs 'npcgeneratec', 0, $wombpotfath[cycletemp], rand(18,60)
			$wombpotfath[cycletemp] = $npclastgenerated
		end
		cycletemp +=1
		jump 'wombpotupd'
	end
	cycletemp = 0
	:cumfthupd
		if cycletemp < arrsize('$cumfthname'):
		tempnpcid = arrpos('$pcs_firstname', $cumfthname[cycletemp])
		if tempnpcid > 0:
			MSG '<br><b><font color="teal">DEBUG: Legacy name in save updated from <<$cumfthname[cycletemp]>> to A<<tempnpcid>></font></b>'
			$cumfthname[cycletemp] = 'A<<tempnpcid>>'
		else
			MSG '<br><b><font color="red">WARNING: Unable to upgrade correctly father entry <<cycletemp>> with name <<$cumfthname[cycletemp]>></font></b>'
			gs 'npcgeneratec', 0, $cumfthname[cycletemp], rand(18,60)
			$cumfthname[cycletemp] = $npclastgenerated
		end
		cycletemp +=1
		jump 'cumfthupd'
	end
end

if Astat_horny[0] > 0: pcs_horny = Astat_horny[0]
if Astat_stren[0] > 0: pcs_stren = Astat_stren[0]
if Astat_agil[0] > 0: pcs_agil = Astat_agil[0]
if Astat_vital[0] > 0: pcs_vital = Astat_vital[0]
if Astat_intel[0] > 0: pcs_intel = Astat_intel[0]
if Astat_haircol[0] > 0: pcs_haircol = Astat_haircol[0]
if Astat_grades[0] > 0: pcs_grades = Astat_grades[0]
if Astat_tan[0] > 0: pcs_tan = Astat_tan[0]
if Astat_vball[0] > 0: pcs_vball = Astat_vball[0]
if Astat_hairlng[0] > 0: pcs_hairlng = Astat_hairlng[0]
if Astat_dom[0] > 0: pcs_dom = Astat_dom[0]
if $Astat_firstname[0] ! '': $pcs_firstname = $Astat_firstname[0]
if $Astat_nickname[0] ! '': $pcs_nickname = $Astat_nickname[0]
if $Astat_lastname[0] ! '': $pcs_lastname = $Astat_lastname[0]

if horny > 0: pcs_horny += horny & killvar 'horny'
if stren > 0: pcs_stren += stren & killvar 'stren'
if agil > 0: pcs_agil += agil & killvar 'agil'
if vital > 0: pcs_vital += vital & killvar 'vital'
if intel > 0: pcs_intel += intel & killvar 'intel'
if hcol > 0: pcs_haircol += hcol & killvar 'hcol'
if Suspeh > 0: pcs_grades += Suspeh & killvar 'Suspeh'
if tan > 0: pcs_tan += tan & killvar 'tan'
if volleyboll > 0: pcs_vball += volleyboll & killvar 'volleyboll'
if hairlength > 0: pcs_hairlng += hairlength & killvar 'hairlength'
if dom > 0: pcs_dom += dom & killvar 'dom'
if $name ! '': $pcs_firstname = $name & killvar '$name'
if $nickname ! '': $pcs_nickname = $nickname & killvar '$nickname'
if $surname ! '': $pcs_lastname = $surname & killvar '$surname'

killvar 'Astat'

--- saveupdater ---------------------------------


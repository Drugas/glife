# saveupdater


if VersionCheck < 504:
	gs 'npcstatic'
	Astat_dob[pc] = birthyear * 10000
	Astat_dob[pc] += birthmonth * 100
	Astat_dob[pc] += birthday
	Astat_horny[pc] = horny
	Astat_stren[pc] = stren
	Astat_agil[pc]  = agil
	Astat_vital[pc] = vital
	Astat_intel[pc] = intel
	Astat_haircol[pc] = hcol
	Astat_rel[28] = father
	Astat_rel[29] = mother
	Astat_rel[33] = sister
	Astat_rel[34] = brother
	Astat_grades[pc] = Suspeh
	Astat_tan[pc] = tan
	Astat_vball[pc] = volleyboll
	Astat_hairlng[pc] = hairlength
	Astat_haircol[pc] = hcol
	Astat_nerd[pc] = nerdism
	Astat_dom[pc] = dom
	$Astat_firstname[npctemp] = $name
	$Astat_nickname[npctemp] = $nickname
	$Astat_lastname[npctemp] = $surname
	$Astat_usedname[npctemp] = $nickname
	VersionCheck = 5030
	Astat_Qstlvl[33] = sisboyQW
	Astat_Qstlvl[34] = brotherQW
	Astat_Qstlvl[29] = motherQW
	Astat_Qstlvl[89] = barmenshameet
	Astat_rel[89] = JenyaLC
	LCEugenefirst = JenyaLCfirst
	killvar 'sisboyQW'
	killvar 'brotherQW'
	killvar 'motherQW'
	killvar 'barmenshameet'
	killvar 'JenyaLC'
	killvar 'JenyaLCfirst'
	killvar 'horny'
	killvar 'stren'
	killvar 'agil'
	killvar 'vital'
	killvar 'intel'
	killvar 'hcol'
	killvar 'father'
	killvar 'mother'
	killvar 'sister'
	killvar 'brother'
	killvar 'Suspeh'
	killvar 'tan'
	killvar 'volleyboll'
	killvar 'hairlength'
	killvar 'hcol'
	killvar 'nerdism'
	killvar 'dom'
	killvar '$name'
	killvar '$nickname'
	killvar '$surname'
	killvar '$boy'
	$boy = 'D0'

	!!The following part update the cum related arrays from an old savegame to the new MGX format.
	cycletemp = 0
	:cumarrupd
	if cycletemp < arrsize('$cumarrnam'):
		tempnpcid = arrpos('$Astat_usedname', $cumarrnam[cycletemp])
		if tempnpcid > 0:
			MSG '<br><b><font color="teal">DEBUG: Legacy name in save updated from <<$cumarrnam[cycletemp]>> to A<<tempnpcid>></font></b>'
			$cumarrnam[cycletemp] = 'A<<tempnpcid>>'
		elseif cumarrkno[cycletemp] > 0:
			MSG '<br><b><font color="red">WARNING: Unable to upgrade correctly cum entry <<cycletemp>> with name <<$cumarrnam[cycletemp]>></font></b>'
			gs 'npcgeneratec', 0, $cumarrnam[cycletemp], rand(18,60)
			$cumarrnam[cycletemp] = $npclastgenerated
		else
			gs 'npcgeneratec', 0, $cumarrnam[cycletemp], rand(18,60)
			$cumarrnam[cycletemp] = $npclastgenerated
		end
		cycletemp += 1
		jump 'cumarrupd'
	end
	cycletemp = 0
	:sparrupd
	if cycletemp < arrsize('$sparrnam'):
		tempnpcid = arrpos('$Astat_usedname', $sparrnam[cycletemp])
		if tempnpcid > 0:
			MSG '<br><b><font color="teal">DEBUG: Legacy name in save updated from <<$sparrnam[cycletemp]>> to A<<tempnpcid>></font></b>'
			$sparrnam[cycletemp] = 'A<<tempnpcid>>'
		elseif sparrkno[cycletemp] > 0:
			MSG '<br><b><font color="red">WARNING: Unable to upgrade correctly spatter entry <<cycletemp>> with name <<$sparrnam[cycletemp]>></font></b>'
			gs 'npcgeneratec', 0, $sparrnam[cycletemp], rand(18,60)
			$sparrnam[cycletemp] = $npclastgenerated
		else
			gs 'npcgeneratec', 0, $sparrnam[cycletemp], rand(18,60)
			$sparrnam[cycletemp] = $npclastgenerated
		end
		cycletemp +=1
		jump 'sparrupd'
	end
	cycletemp = 0
	:cumcbcupd
	if cycletemp < arrsize('$ChildFath'):
		tempnpcid = arrpos('$Astat_usedname', $ChildFath[cycletemp])
		if tempnpcid > 0:
			MSG '<br><b><font color="teal">DEBUG: Legacy name in save updated from <<$ChildFath[cycletemp]>> to A<<tempnpcid>></font></b>'
			$ChildFath[cycletemp] = 'A<<tempnpcid>>'
		else
			MSG '<br><b><font color="red">WARNING: Unable to upgrade correctly father entry <<cycletemp>> with name <<$ChildFath[cycletemp]>></font></b>'
			gs 'npcgeneratec', 0, $ChildFath[cycletemp], rand(18,60)
			$ChildFath[cycletemp] = $npclastgenerated
		end
		tempnpcid = arrpos('$Astat_usedname', $ChildThFath[cycletemp])
		if tempnpcid > 0:
			MSG '<br><b><font color="teal">DEBUG: Legacy name in save updated from <<$ChildThFath[cycletemp]>> to A<<tempnpcid>></font></b>'
			$ChildThFath[cycletemp] = 'A<<tempnpcid>>'
		else
			MSG '<br><b><font color="red">WARNING: Unable to upgrade correctly tought father entry <<cycletemp>> with name <<$ChildThFath[cycletemp]>></font></b>'
			$ChildThFath[cycletemp] = 'unknown'
		end
		cycletemp +=1
		jump 'cumcbcupd'
	end
end


--- saveupdater ---------------------------------

